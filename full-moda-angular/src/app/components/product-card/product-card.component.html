<div class="product-card group" role="article" [attr.aria-labelledby]="'product-title-' + product.id" [attr.aria-describedby]="'product-description-' + product.id">
  <!-- Imagen del producto -->
  <div class="image-container">
    <!-- Imagen principal -->
    <img
      *ngIf="product?.imagenes && product.imagenes.length > 0"
      [src]="product.imagenes[0]"
      [alt]="'Imagen del producto ' + product.nombre"
      (click)="toggleZoom()"
      role="button"
      tabindex="0"
      [attr.aria-label]="'Ampliar imagen de ' + product.nombre"
      (keydown.enter)="toggleZoom()"
      (keydown.space)="$event.preventDefault(); toggleZoom()"
    >
    <!-- Fallback si no hay imágenes -->
    <div *ngIf="!product?.imagenes || product.imagenes.length === 0" class="image-fallback" role="img" [attr.aria-label]="'Imagen no disponible para ' + product.nombre">
      {{ product.nombre.charAt(0) }}
    </div>

    <!-- Precio -->
    <div class="price-badge" role="text" [attr.aria-label]="'Precio: ' + getCurrentPrice() + ' soles'">
      S/ {{ getCurrentPrice() }}
    </div>

    <!-- Indicador de stock -->
    <div class="stock-badge" [ngClass]="getStockStatusClass()" role="status" [attr.aria-label]="getStockStatusText() + ' en stock'">
      {{ getStockStatusText() }}
    </div>

    <!-- Overlay con botones -->
    <div class="overlay" role="toolbar" [attr.aria-label]="'Acciones para ' + product.nombre">
      <div class="action-buttons">
        <button (click)="viewDetails()" class="view-details" [attr.aria-label]="'Ver detalles de ' + product.nombre">
          <i class="fas fa-eye" aria-hidden="true"></i>
        </button>
        <button (click)="addToCart()" class="add-to-cart" [attr.aria-label]="'Agregar ' + product.nombre + ' al carrito'">
          <i class="fas fa-shopping-cart" aria-hidden="true"></i>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Modal para seleccionar talla y cantidad -->
  <div *ngIf="showSizeModal" class="fixed inset-0 bg-black bg-opacity-50 z-[1200] flex items-center justify-center p-4" (click)="closeSizeModal()">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6" (click)="$event.stopPropagation()">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold text-gray-800">Seleccionar Talla y Cantidad</h3>
        <button (click)="closeSizeModal()" class="text-gray-400 hover:text-gray-600">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
  
      <div class="mb-6">
        <h4 class="font-semibold text-gray-700 mb-2">Talla</h4>
        <div class="grid grid-cols-4 gap-2">
          <button
            *ngFor="let talla of product.tallas"
            (click)="selectModalSize(talla)"
            [class]="selectedSize === talla
              ? 'bg-purple-600 text-white border-purple-600'
              : 'bg-white text-gray-700 border-gray-300 hover:border-purple-400'"
            class="px-4 py-2 border-2 rounded-lg font-medium transition-all duration-200">
            {{ talla }}
          </button>
        </div>
      </div>
  
      <div class="mb-6">
        <h4 class="font-semibold text-gray-700 mb-2">Cantidad</h4>
        <div class="flex items-center justify-center gap-4">
          <button
            (click)="decreaseModalQuantity()"
            class="w-10 h-10 bg-gray-200 hover:bg-gray-300 rounded-full flex items-center justify-center text-gray-700 transition duration-200"
            [disabled]="modalQuantity <= 1">
            <i class="fas fa-minus text-sm"></i>
          </button>
          <span class="text-xl font-bold text-gray-800 min-w-[3rem] text-center">{{ modalQuantity }}</span>
          <button
            (click)="increaseModalQuantity()"
            class="w-10 h-10 bg-gray-200 hover:bg-gray-300 rounded-full flex items-center justify-center text-gray-700 transition duration-200"
            [disabled]="modalQuantity >= product.stock">
            <i class="fas fa-plus text-sm"></i>
          </button>
        </div>
        <p class="text-xs text-gray-500 text-center mt-2">
          Stock disponible: {{ product.stock }}
        </p>
      </div>
  
      <button
        (click)="confirmAddToCart()"
        [disabled]="!selectedSize"
        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 disabled:from-gray-400 disabled:to-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:from-purple-700 hover:to-pink-700 transition duration-300">
        Agregar al Carrito
      </button>
    </div>
  </div>
  
  <!-- Modal de zoom de imagen -->
  <div *ngIf="isZoomed" class="zoom-modal z-[1100]" (click)="closeZoom()" role="dialog" [attr.aria-labelledby]="'zoom-title-' + product.id" [attr.aria-describedby]="'zoom-description-' + product.id">
    <div class="zoom-content" (click)="$event.stopPropagation()">
      <!-- Imagen ampliada -->
      <img
        *ngIf="product.imagenes && product.imagenes.length > 0"
        [src]="product.imagenes[currentImageIndex]"
        [alt]="'Imagen ampliada de ' + product.nombre"
        [id]="'zoom-title-' + product.id"
      >

      <!-- Descripción para lectores de pantalla -->
      <div id="zoom-description-{{product.id}}" class="sr-only">
        Imagen {{ currentImageIndex + 1 }} de {{ product.imagenes.length }} para el producto {{ product.nombre }}
      </div>

      <!-- Botón cerrar -->
      <button
        (click)="closeZoom()"
        class="close-button"
        [attr.aria-label]="'Cerrar vista ampliada de ' + product.nombre"
        (keydown.escape)="closeZoom()">
        <i class="fas fa-times" aria-hidden="true"></i>
      </button>

      <!-- Navegación removida para usar solo una imagen por producto -->
    </div>
  </div>

  <!-- Contenido de la card -->
  <div class="card-content">
    <!-- Badge de categoría -->
    <div class="category-badge" role="text" [attr.aria-label]="'Categoría: ' + product.categoria">
      {{ product.categoria }}
    </div>

    <!-- Título del producto -->
    <h3 class="product-title" [id]="'product-title-' + product.id">
      {{ product.nombre }}
    </h3>

    <!-- Marca -->
    <div class="brand-info" role="text" [attr.aria-label]="'Marca: ' + product.marca">
      <i class="fas fa-tag" aria-hidden="true"></i>
      <span>{{ product.marca }}</span>
    </div>

    <!-- Selector de talla -->
    <div class="size-selector" *ngIf="product.tallas && product.tallas.length > 0">
      <label class="size-label">Talla:</label>
      <div class="size-buttons">
        <button
          *ngFor="let talla of product.tallas"
          (click)="selectSize(talla)"
          [class.selected]="selectedSize === talla"
          class="size-button"
          [attr.aria-label]="'Seleccionar talla ' + talla"
          [attr.aria-pressed]="selectedSize === talla">
          {{ talla }}
        </button>
      </div>
    </div>

    <!-- Descripción removida -->

    <!-- Información adicional -->
    <div class="additional-info">
      <div class="rating" role="text" aria-label="Calificación y ventas">
        <i class="fas fa-star" aria-hidden="true"></i>
        <span>4.5</span>
        <span aria-hidden="true">•</span>
        <span>vendidos</span>
      </div>
      <div class="availability" role="status" [attr.aria-label]="getStockStatusText()">
        ✓ Disponible
      </div>
    </div>
  </div>
</div>
